<div class="container">
    <div class="row">
      <h2>Logs</h2>
      <table id="logsTable" class="table table-striped">
        <thead>
          <tr>
            <th scope="col">id</th>
            <th scope="col">Date & Time</th>
            <th scope="col">Message</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
  <script type="text/javascript">
  
    $(function() {
      $("#rootmenu-logs").addClass("active");

      function updateSystem()
      {
        $.ajax({
            type: "GET",
            url: "/api/status",
            dataType : "json"
          }).done((data)=>{
            $("#footer-version").text(data.systemVersion)
            $("#mqtt-state").val(data.mqttState);
        });
      }
      updateSystem();

      function updateLogs()
      {
        $.ajax({
            type: "GET",
            url: "/api/logs",
            dataType : "json"
          }).done((data)=>{
            $("#logsTable tbody").children().remove();

            data.reverse();
            for(let log of data)
            {
              $("#logsTable tbody").append(`<tr id="log-${log.id}"><th>${log.id}</th><td>${log.datetime}</td><td>${log.message}</td></tr>`);
            }
        });
      }
      updateLogs();

      let eventId="";
      function getEvents()
      {
        $.ajax({
          type: "GET",
          url: `/api/events?lastEvent=${eventId}`,
          dataType : "json"
        }).done((data)=>{
          eventId = data.id;
  
          for(const eventType of data.events)
          {
            if(eventType === "SYSTEM")
            {
              updateSystem();
            }
            if(eventType === "LOG")
            {
              updateLogs();
            }
          }
  
          setTimeout(getEvents, 500);
        });
      }
  
      getEvents();
  
    });
    
  </script>